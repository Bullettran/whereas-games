import{_ as $}from"./CuKWJm8L.js";import y from"./CAmk0RAb.js";import{m as S,_ as A,c as i,a as s,F as d,n as f,u as C,q as g,t as o,b,w as D,o as a}from"./DIc1lTRk.js";import"./H-TcsJHu.js";const w=S({name:"Index",setup(){},data:()=>({currentChoice:null,selectedSpecies:{value:"",name:""},stats:{attack:1,critical:1,hp:1,mp:1,hitChance:1,dodge:1,speed:1,defence:1},professions:{},errorMessage:"",characters:[{value:"ranger",name:"Рейнджер",stats:{attack:1,critical:2,hp:5,mp:5,hitChance:52,dodge:21,speed:2,defence:0},description:`Рейнджер — неуловимый следопыт, чьи стрелы находят цель даже в кромешной тьме. Его дом — леса и
                        равнины, где он сливается с природой, подобно тени. Соколиный глаз и лёгкий шаг позволяют ему
                        наносить точечные удары, оставаясь незамеченным. Каждый выстрел — это вызов судьбе, а каждый
                        промах — лишь повод для новой охоты.`,professions:{name:"cooking",short:"Приготовление пищи",lvl:1,description:"Приготовление пищи (бонусы к созданию блюд)",exp:0,needExp:10}},{value:"wrecker",name:"Крушитель",stats:{attack:3,critical:1,hp:8,mp:5,hitChance:50,dodge:20,speed:1,defence:3},description:`Крушитель — несокрушимая гора, чей молот дробит скалы и врагов с равной лёгкостью. Его броня,
                        выкованная в недрах вулканов, отражает любой удар, а сердце пылает яростью клана. Он стоит на
                        передовой, принимая на себя главный удар, чтобы защитить союзников. Каждый бой для него —
                        проверка стойкости.`,professions:{name:"blacksmith",short:"Кузнец",lvl:1,description:"Кузнец (бонусы к созданию брони)",exp:0,needExp:10}},{value:"arcanist",name:"Арканист",stats:{attack:3,critical:1,hp:6,mp:8,hitChance:50,dodge:20,speed:2,defence:1},description:`Арканист — повелитель тайн, чьи заклинания сотканы из нитей эфира. Его разум — лабиринт знаний,
                        а посох — проводник магической силы. Он манипулирует стихиями, замораживая врагов или испепеляя
                        их одним движением руки. Но за каждым заклинанием стоит цена, которую он готов заплатить ради
                        истины.`,professions:{name:"tailoring",short:"Портняжное дело",lvl:1,description:"Портняжное дело (бонусы к созданию ткани).",exp:0,needExp:10}},{value:"monk",name:"Монах",stats:{attack:1,critical:1,hp:6,mp:5,hitChance:50,dodge:21,speed:2,defence:2},description:`Монах — воплощение гармонии, чья душа чиста, как горный родник. Его кулаки — оружие, закалённое
                        годами тренировок, а разум — щит от соблазнов. Он движется с грацией ветра, уклоняясь от ударов
                        и очищая мир от скверны. Для монаха бой — это путь к просветлению, а не к разрушению.`,professions:{name:"Alchemy",short:"Алхимия",lvl:1,description:"Алхимия (бонусы к созданию зелий).",exp:0,needExp:10}},{value:"inferno",name:"Инферно",stats:{attack:2,critical:2,hp:7,mp:6,hitChance:50,dodge:20,speed:2,defence:3},description:`Инферно — пламя войны, чей меч горит жарче солнца. Его атаки подобны огненному шторму,
                        оставляющему за собой лишь пепел. Доспехи, пропитанные магией вулканов, делают его неуязвимым
                        для слабых. Он сражается не ради славы, а ради искры, что пылает в его душе.`,professions:{name:"gunsmith",short:"Оружейник",lvl:1,description:"Оружейник (бонусы к созданию оружия).",exp:0,needExp:10}},{value:"assassin",name:"Ассасин",stats:{attack:3,critical:5,hp:5,mp:5,hitChance:50,dodge:20,speed:2,defence:1},description:`Ассасин — призрак ночи, чьи клинки шепчут о смерти. Он скользит в тенях, нанося смертельные
                        удары, прежде чем враг успеет моргнуть. Его движения точны, как механизм часов, а глаза холодны,
                        как сталь. Ассасин не знает пощады, но его сердце хранит тайну, которую никто не раскроет.`,professions:{name:"collector",short:"Коллекционер",lvl:1,description:"Коллекционер (бонусы к поиску редких ресурсов).",exp:0,needExp:10}}]}),methods:{onChoice(e){this.currentChoice=e},onSelect(e){this.selectedSpecies.value=e.value,this.selectedSpecies.name=e.name,this.stats=e.stats,this.professions=e.professions},async onAccept(){if(this.errorMessage="",!this.selectedSpecies.value){this.errorMessage="Выберите персонажа";return}try{const{data:e,error:t}=await this.$supabase.auth.getUser();if(t||!e.user){this.errorMessage="Ошибка: пользователь не авторизован";return}const p=e.user.id,{error:c}=await this.$supabase.from("characters").upsert({id:p,species:this.selectedSpecies.value,species_name:this.selectedSpecies.name,stats:this.stats,game_stats:{freeCount:0,currentExp:0,level:1,currentEnergy:10,maxEnergy:10},professions:[this.professions]});if(c){this.errorMessage=`Ошибка сохранения персонажа: ${c.message}`,console.error(c);return}const{error:r}=await this.$supabase.auth.updateUser({data:{isSelectedSpecies:!0}});if(r){this.errorMessage=`Ошибка обновления пользователя: ${r.message}`,console.error(r);return}let l=document.querySelector(".accept__button--close");l&&l.click(),this.$router.push("/town/")}catch(e){this.errorMessage="Неизвестная ошибка. Попробуйте позже.",console.error(e)}}},async mounted(){const{data:e,error:t}=await this.$supabase.auth.getUser();if(t||!e.user){this.errorMessage="Ошибка: пользователь не авторизован",this.$router.push("/");return}e.user.user_metadata.isSelectedSpecies}}),B={class:"selections"},M={class:"selections__container container"},F={class:"selections__wrap"},x={class:"selections__cards"},I=["onClick"],N={class:"selections__picture"},U={class:"selections__type"},V={class:"selections__person animate"},q={key:0,class:"selections__info"},z={class:"selections__stats"},L={class:"selections__list list"},j={class:"selections__name"},G={class:"selections__value"},H={class:"selections__description"},J={class:"selections__professions"},K={class:"selections__items"},O={class:"selections__item-val"},P={class:"selections__buttons"},Q={class:"accept"},R={class:"accept__title h3"},T={class:"accept__buttons"};function W(e,t,p,c,r,l){var _,h,m,v;const E=$,k=y;return a(),i(d,null,[s("div",B,[s("div",M,[t[6]||(t[6]=s("h1",{class:"selections__title"},"Выбор персонажа",-1)),s("div",F,[s("div",x,[(a(!0),i(d,null,f(e.characters,u=>(a(),i("button",{key:u.value,class:C([e.currentChoice===u.value?"selections__card--active":"","selections__card"]),type:"button",onClick:n=>e.onChoice(u.value)},[s("div",N,[b(E,{class:"selections__image",src:`images/sprites/persons/${u.value}/icon-${u.value}.png`,alt:`Иконка ${u.name}`},null,8,["src","alt"])]),s("div",U,o(u.name),1)],10,I))),128))]),s("div",V,[e.currentChoice?(a(),i("div",{key:0,class:C(`selections__animate animate__${e.currentChoice} animate__idle`)},null,2)):g("",!0)]),e.currentChoice?(a(),i("div",q,[s("div",z,[t[2]||(t[2]=s("h2",{class:"selections__subtitle"},"Характеристики",-1)),s("ul",L,[(a(!0),i(d,null,f((_=e.characters.find(u=>u.value===e.currentChoice))==null?void 0:_.stats,(u,n)=>(a(),i("li",{class:"selections__item",key:n},[s("div",j,o({hp:"Здоровье",mp:"Мана",attack:"Атака",critical:"Критический шанс",hitChance:"Меткость",dodge:"Шанс уворота",speed:"Скорость",defence:"Защита"}[n]),1),s("div",G,o(u)+o(n==="critical"||n==="hitChance"||n==="dodge"?"%":""),1)]))),128))])]),t[5]||(t[5]=s("h2",{class:"selections__subtitle"},"Описание",-1)),s("div",H,o((h=e.characters.find(u=>u.value===e.currentChoice))==null?void 0:h.description),1),s("div",J,[t[4]||(t[4]=s("h2",{class:"selections__subtitle"},"Улучшения",-1)),s("div",K,[t[3]||(t[3]=s("div",{class:"selections__item-name"},[s("strong",null,"Склонность:")],-1)),s("div",O,o((v=(m=e.characters.find(u=>u.value===e.currentChoice))==null?void 0:m.professions)==null?void 0:v.description),1)])]),s("div",P,[s("button",{class:"selections__button button--metal","data-bs-toggle":"modal","data-bs-target":"#accept-species",type:"button",onClick:t[0]||(t[0]=u=>e.onSelect(e.characters.find(n=>n.value===e.currentChoice)))}," Подтвердить ")])])):g("",!0)])])]),b(k,{size:"sm",id:"accept-species"},{default:D(()=>[s("div",Q,[s("h2",R,"Вы выбрали расу: "+o(e.selectedSpecies.name),1),s("div",T,[s("button",{class:"accept__button button button--metal",type:"button",onClick:t[1]||(t[1]=(...u)=>e.onAccept&&e.onAccept(...u))},"Подтвердить"),t[7]||(t[7]=s("button",{class:"accept__button accept__button--close button button--metal",type:"button","data-bs-dismiss":"modal"}," Отменить ",-1))])])]),_:1})],64)}const se=A(w,[["render",W],["__scopeId","data-v-38cbfaa7"]]);export{se as default};
