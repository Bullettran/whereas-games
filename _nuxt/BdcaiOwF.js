import{u as n}from"./ZtCTLdtK.js";import{m as c,_ as f,o as i,c as l,a as s,ab as d,ac as m,t as h,q as _,ad as b}from"./1EpAYDnX.js";const w=c({name:"Auth",data(){return{form:{username:"",password:""},formError:""}},methods:{async logIn(){if(this.formError="",!this.form.username||!this.form.password){this.formError="Заполните все поля";return}try{const{data:t,error:o}=await this.$supabase.auth.signInWithPassword({email:`${this.form.username}@mail.ru`,password:this.form.password});if(o){this.formError="Ошибка входа: неверное имя пользователя или пароль";return}const a=t.user,e=n();e.setLogin(a.user_metadata.username||this.form.username),e.setSpecies(a.user_metadata.isSelectedSpecies||!1),e.setAdmin(a.user_metadata.isAdmin||!1);const u=this.$bootstrap.Modal.getInstance(document.querySelector("#auth"));u&&u.hide(),e.isSelectedSpecies?this.$router.push("/town/"):this.$router.push("/selections/")}catch(t){this.formError="Неизвестная ошибка. Попробуйте позже.",console.error(t)}},async logOut(){try{const{error:t}=await this.$supabase.auth.signOut();if(t)throw t;n().clear();const e=this.$bootstrap.Modal.getInstance(document.querySelector("#auth"));e&&e.hide()}catch(t){this.formError="Ошибка выхода: "+t.message,console.error(t)}}}}),E={class:"auth"},g={class:"auth__field"},y={class:"auth__field"},S={key:0,class:"auth__error"},$={class:"auth__buttons"};function v(t,o,a,e,p,u){return i(),l("div",E,[o[5]||(o[5]=s("h2",{class:"auth__title"},"Вход",-1)),s("form",{enctype:"application/x-www-form-urlencoded",onSubmit:o[3]||(o[3]=b((...r)=>t.logIn&&t.logIn(...r),["prevent"]))},[s("div",g,[d(s("input",{class:"auth__input","onUpdate:modelValue":o[0]||(o[0]=r=>t.form.username=r),type:"text",autocomplete:"off",placeholder:"Имя пользователя"},null,512),[[m,t.form.username]])]),s("div",y,[d(s("input",{class:"auth__input","onUpdate:modelValue":o[1]||(o[1]=r=>t.form.password=r),type:"password",autocomplete:"current-password",placeholder:"Пароль"},null,512),[[m,t.form.password]])]),t.formError?(i(),l("div",S,h(t.formError),1)):_("",!0),s("div",$,[o[4]||(o[4]=s("button",{class:"auth__button button button--metal",type:"submit"},"Войти",-1)),s("button",{class:"auth__button button button--metal",type:"button",onClick:o[2]||(o[2]=(...r)=>t.logOut&&t.logOut(...r))},"Выйти")])],32)])}const C=f(w,[["render",v],["__scopeId","data-v-4a765dcb"]]);export{C as default};
